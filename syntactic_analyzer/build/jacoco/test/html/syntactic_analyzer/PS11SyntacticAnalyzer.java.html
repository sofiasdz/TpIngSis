<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css" />
    <link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif" />
    <title>PS11SyntacticAnalyzer.java</title>
    <link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css" />
    <script type="text/javascript" src="../jacoco-resources/prettify.js"></script>
  </head>
  <body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
    <div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">syntactic_analyzer</a> &gt; <a href="index.source.html" class="el_package">syntactic_analyzer</a> &gt; <span class="el_source">PS11SyntacticAnalyzer.java</span></div>
    <h1>PS11SyntacticAnalyzer.java</h1>
    <pre class="source lang-java linenums">package syntactic_analyzer;

import ASTNode.ASTNode;
import ASTNode.Factory.ASTNodeFactory11;
import ASTNode.NotChildless.ASTNodeAssignation;
import ASTNode.TokenGroup.TokenGroup;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.Stack;
import token.Token;
import token.TokenType;

public class PS11SyntacticAnalyzer implements SyntacticAnalyzer {

<span class="fc" id="L16">  public PS11SyntacticAnalyzer() {}</span>

  @Override
  public List&lt;ASTNode&gt; analyze(List&lt;Token&gt; tokens) {
<span class="fc" id="L20">    List&lt;ASTNode&gt; nodes = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L21">    List&lt;Token&gt; tokenList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L22" title="All 2 branches covered.">    for (int i = 0; i &lt; tokens.size(); i++) {</span>
<span class="fc" id="L23">      tokenList.add(tokens.get(i));</span>
<span class="fc bfc" id="L24" title="All 2 branches covered.">      if (tokens.get(i).getType().equals(TokenType.SEMICOLON)) {</span>
<span class="fc" id="L25">        nodes.add(tokensToNode(tokenList));</span>
<span class="fc" id="L26">        tokenList = new ArrayList&lt;&gt;();</span>
      }
    }
<span class="fc" id="L29">    return nodes;</span>
  }

  public ASTNode tokensToNode(List&lt;Token&gt; tokens) {
<span class="fc" id="L33">    Stack&lt;ASTNode&gt; nodeStack = new Stack&lt;&gt;();</span>
<span class="fc" id="L34">    List&lt;Token&gt; tokenList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L35" title="All 2 branches covered.">    for (int i = tokens.size() - 1; i &gt;= 0; i--) {</span>
<span class="fc" id="L36">      Optional&lt;ASTNode&gt; optionalASTNode = ASTNodeIdentifier(tokens.get(i));</span>
<span class="fc bfc" id="L37" title="All 2 branches covered.">      if (optionalASTNode.isEmpty()) tokenList.add(tokens.get(i));</span>
<span class="fc" id="L38">      else nodeStack.push(optionalASTNode.get());</span>
      // Si el optional es un nodo, lo stackeo. Voy de atr√°s para adelante para no tener problema
      // con los nodos
    }
<span class="fc bfc" id="L42" title="All 2 branches covered.">    for (int i = tokenList.size() - 1; i &gt;= 0; i--) {</span>
<span class="fc" id="L43">      if (tokenList.get(i).getType().equals(TokenType.LET)</span>
<span class="fc bfc" id="L44" title="All 2 branches covered.">          | tokenList.get(i).getType().equals(TokenType.SEMICOLON)) tokenList.remove(i);</span>
    }

<span class="fc bfc" id="L47" title="All 2 branches covered.">    while (nodeStack.size() &gt; 1) {</span>
<span class="fc" id="L48">      ASTNode left = nodeStack.pop();</span>
<span class="fc" id="L49">      ASTNode right = nodeStack.pop();</span>
<span class="fc" id="L50">      Optional&lt;ASTNode&gt; optionalASTNode =</span>
<span class="fc" id="L51">          ASTNodeIdentifier(tokenList.get(tokenList.size() - 1), left, right);</span>
<span class="fc bfc" id="L52" title="All 2 branches covered.">      if (optionalASTNode.isPresent()) {</span>
<span class="fc" id="L53">        nodeStack.push(optionalASTNode.get());</span>
<span class="fc" id="L54">        tokenList.remove(tokenList.size() - 1);</span>
      } else {
<span class="fc" id="L56">        optionalASTNode = ASTNodeIdentifier(tokenList.get(tokenList.size() - 1), right, left);</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">        if (optionalASTNode.isPresent()) {</span>
<span class="fc" id="L58">          nodeStack.push(optionalASTNode.get());</span>
<span class="fc" id="L59">          tokenList.remove(tokenList.size() - 1);</span>
        } else {
<span class="fc" id="L61">          nodeStack.push(right);</span>
<span class="fc" id="L62">          nodeStack.push(left);</span>
<span class="fc" id="L63">          nodeStack = operationCheck(nodeStack, tokenList);</span>
        }
      }
<span class="fc" id="L66">    }</span>
<span class="fc" id="L67">    return nodeStack.pop();</span>
  }

  Stack&lt;ASTNode&gt; operationCheck(Stack&lt;ASTNode&gt; nodeStack, List&lt;Token&gt; tokenList) {
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">    if (nodeStack.peek().token.getType().equals(TokenType.ASSIGNATION)) {</span>
<span class="fc" id="L72">      TokenGroup group =</span>
          new TokenGroup(
<span class="fc" id="L74">              List.of(</span>
                  TokenType.ADDITION,
                  TokenType.SUBSTRACTION,
                  TokenType.DIVISION,
                  TokenType.MULTIPLICATION));
<span class="fc bfc" id="L79" title="All 2 branches covered.">      for (int i = 0; i &lt; tokenList.size(); i++) {</span>
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">        if (group.belongs(tokenList.get(i))) {</span>
<span class="fc" id="L81">          ASTNodeAssignation node1 = (ASTNodeAssignation) nodeStack.pop();</span>
<span class="fc" id="L82">          ASTNode node2 = nodeStack.pop();</span>
<span class="fc" id="L83">          Optional&lt;ASTNode&gt; operation =</span>
<span class="fc" id="L84">              ASTNodeIdentifier(tokenList.get(i), node1.getRightChild(), node2);</span>
<span class="fc" id="L85">          node1.setRightChild(operation.get());</span>
<span class="fc" id="L86">          nodeStack.push(node1);</span>
        }
      }
    }
<span class="fc" id="L90">    return nodeStack;</span>
  }

  Optional&lt;ASTNode&gt; ASTNodeIdentifier(Token token) {
<span class="fc bfc" id="L94" title="All 2 branches covered.">    if (token.getType().equals(TokenType.IDENTIFIER)) {</span>
<span class="fc" id="L95">      return Optional.of(ASTNodeFactory11.identifier(token));</span>
<span class="fc" id="L96">    } else if (token.getType().equals(TokenType.NUMBER_TYPE)</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">        | token.getType().equals(TokenType.STRING_TYPE)) {</span>
<span class="fc" id="L98">      return Optional.of(ASTNodeFactory11.variableType(token));</span>
    } else {
      try {
<span class="fc" id="L101">        return Optional.of(ASTNodeFactory11.literal(token));</span>
<span class="fc" id="L102">      } catch (IllegalArgumentException e) {</span>
        try {
<span class="fc" id="L104">          return Optional.of(ASTNodeFactory11.print(token));</span>
<span class="fc" id="L105">        } catch (IllegalArgumentException j) {</span>
<span class="fc" id="L106">          return Optional.empty();</span>
        }
      }
    }
  }

  Optional&lt;ASTNode&gt; ASTNodeIdentifier(Token token, ASTNode left, ASTNode right) {
    try {
<span class="fc" id="L114">      return Optional.of(ASTNodeFactory11.assignation(token, left, right));</span>
<span class="fc" id="L115">    } catch (IllegalArgumentException e) {</span>
      try {
<span class="fc" id="L117">        return Optional.of(ASTNodeFactory11.declaration(token, left, right));</span>
<span class="fc" id="L118">      } catch (IllegalArgumentException i) {</span>
        try {
<span class="fc" id="L120">          return Optional.of(ASTNodeFactory11.operation(token, left, right));</span>
<span class="fc" id="L121">        } catch (IllegalArgumentException h) {</span>
<span class="fc" id="L122">          return Optional.empty();</span>
        }
      }
    }
  }
}
</pre>
    <div class="footer">
      <span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span>
    </div>
  </body>
</html>
